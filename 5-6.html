<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours Interactif : Cha√Ænes de Markov (DTMC)</title>
    
    <!-- MathJax Configuration -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #c0392b;
            --light: #ecf0f1;
            --bg: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        h1, h2, h3 { color: var(--primary); }
        h1 { text-align: center; border-bottom: 3px solid var(--accent); padding-bottom: 10px; margin-bottom: 30px; }
        h2 { border-left: 5px solid var(--accent); padding-left: 10px; margin-top: 40px; background: #eaf2f8; padding: 10px; }

        /* Pedagogical Boxes */
        .box {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 5px solid;
        }
        .def { background-color: #e8f4fd; border-color: var(--accent); }
        .vigilance { background-color: #fff3cd; border-color: var(--warning); }
        .tip { background-color: #e9f7ef; border-color: var(--success); }
        
        .box h4 { margin-top: 0; display: flex; align-items: center; gap: 10px; }

        /* Mini Exercises */
        .exercise {
            background: #fff;
            border: 2px dashed var(--primary);
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }
        .exercise-header { font-weight: bold; color: var(--primary); margin-bottom: 10px; }
        .solution-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        .solution-btn:hover { background-color: #1a252f; }
        .solution-content {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 3px solid var(--success);
        }

        /* Graph Containers */
        .graph-container {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            overflow-x: auto;
        }
        .graph-source { display: none; } /* Hidden text areas for graph code */

        /* Tables for Solutions */
        table.sol-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table.sol-table th, table.sol-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        table.sol-table th { background-color: var(--accent); color: white; }
        table.sol-table tr:nth-child(even) { background-color: #f2f2f2; }

        code { background: #f1f1f1; padding: 2px 5px; border-radius: 3px; font-family: monospace; color: #c7254e; }
    </style>
</head>
<body>

<div class="container">

    <h1>Partie II : Cha√Ænes de Markov √† Temps Discret (DTMC)</h1>
    <p class="intro">
        Ce module couvre les fondements des syst√®mes stochastiques √©voluant par √©tapes discr√®tes. Nous explorerons la structure matricielle, la visualisation graphique et le comportement √† long terme (r√©gime stationnaire).
    </p>

    <!-- ================= CHAPTER 5 ================= -->
    <h2>Chapitre 5 : Structure et Classification</h2>

    <div class="box def">
        <h4>üìò D√©finition : La Propri√©t√© de Markov</h4>
        <p>Un syst√®me poss√®de la propri√©t√© de Markov (ou "absence de m√©moire") si la pr√©diction du futur ne d√©pend que de l'√©tat <strong>pr√©sent</strong>, et non de l'historique pass√©.</p>
        $$ P(X_{n+1} = j \mid X_n = i, \dots, X_0 = i_0) = P(X_{n+1} = j \mid X_n = i) = p_{ij} $$
    </div>

    <h3>5.1. La Matrice de Transition $P$</h3>
    <p>La dynamique du syst√®me est enti√®rement d√©crite par une matrice carr√©e $P$ o√π l'√©l√©ment $p_{ij}$ repr√©sente la probabilit√© de passer de l'√©tat $i$ √† l'√©tat $j$.</p>

    <div class="box vigilance">
        <h4>‚ö†Ô∏è Zone de Vigilance : Propri√©t√©s de la Matrice</h4>
        <ul>
            <li>Les probabilit√©s doivent √™tre entre 0 et 1 : $0 \le p_{ij} \le 1$.</li>
            <li><strong>La somme de chaque ligne doit valoir exactement 1</strong> ($\sum_{j} p_{ij} = 1$).</li>
            <li>La somme des colonnes n'a pas d'obligation particuli√®re (sauf cas doublement stochastique).</li>
        </ul>
    </div>

    <!-- MINI EXERCISE 1 -->
    <div class="exercise">
        <div class="exercise-header">üéØ Mini-Exercice 1 : Validit√© d'une Matrice</div>
        <p>La matrice suivante est-elle une matrice de transition valide pour une cha√Æne √† 2 √©tats ?</p>
        $$ M = \begin{pmatrix} 0.5 & 0.5 \\ 0.2 & 0.9 \end{pmatrix} $$
        <button class="solution-btn" onclick="toggle('sol-1')">Voir la r√©ponse</button>
        <div id="sol-1" class="solution-content">
            <strong>R√©ponse : NON.</strong>
            <br>V√©rifions les lignes :
            <ul>
                <li>Ligne 1 : $0.5 + 0.5 = 1$ ‚úÖ</li>
                <li>Ligne 2 : $0.2 + 0.9 = 1.1 \neq 1$ ‚ùå</li>
            </ul>
            La probabilit√© totale de quitter l'√©tat 2 d√©passe 100%, ce qui est impossible.
        </div>
    </div>

    <h3>5.2. Repr√©sentation Graphique</h3>
    <p>Les √©tats sont des n≈ìuds et les transitions positives ($p_{ij} > 0$) sont des arcs orient√©s.</p>

    <h4>Exemple : Le "Jeu du Joueur" (Gambler's Ruin)</h4>
    <p>Un joueur mise 1‚Ç¨ : il gagne (prob $p$) ou perd (prob $1-p$). Il s'arr√™te s'il atteint 0‚Ç¨ (Ruine) ou 3‚Ç¨ (Victoire).</p>
    
    <!-- GRAPH RENDERING AREA -->
    <div class="graph-container" id="graph-gambler"></div>
    <textarea class="graph-source" data-target="graph-gambler">
digraph Gambler {
    rankdir=LR;
    bgcolor="transparent";
    node [fontname="Arial"];
    
    node [shape=doublecircle, style=filled, fillcolor="#e0e0e0"];
    0 [label="0 (Ruine)"]; 
    3 [label="3 (Victoire)"];
    
    node [shape=circle, style=filled, fillcolor="white"];
    1; 2;

    0 -> 0 [label="1"];
    1 -> 0 [label="1-p"];
    1 -> 2 [label="p"];
    2 -> 1 [label="1-p"];
    2 -> 3 [label="p"];
    3 -> 3 [label="1"];
}
    </textarea>

    <h3>5.3. Classification des √âtats</h3>
    <p>Pour comprendre l'√©volution √† long terme, il faut classer les √©tats :</p>
    <ul>
        <li><strong>Transitoire :</strong> Une fois quitt√©, il est possible de ne jamais y revenir.</li>
        <li><strong>R√©current :</strong> Le syst√®me finira par y revenir avec une probabilit√© de 1.</li>
        <li><strong>Absorbant :</strong> Un √©tat qu'on ne peut plus quitter ($p_{ii} = 1$).</li>
    </ul>

    <h4>Analyse de Classes (Graphe Complexe)</h4>
    <p>Observez les connexions dans le graphe ci-dessous. Identifiez les "groupes" d'√©tats qui communiquent entre eux.</p>

    <!-- GRAPH RENDERING AREA -->
    <div class="graph-container" id="graph-class"></div>
    <textarea class="graph-source" data-target="graph-class">
digraph Classification {
    rankdir=TB; 
    bgcolor="transparent";
    node [shape=circle, fontname="Arial"];

    1 [style=dashed, label="1 (T)"]; 
    2 [style=dashed, label="2 (T)"];
    
    node [style=solid, penwidth=2, fillcolor="#e8f4fd", style=filled];
    3;4;5;6;7;
    
    1 -> 2 [label="2/3"];
    1 -> 3 [label="1/3"];
    2 -> 6 [label="1/3"];
    
    subgraph cluster_C3 {
        style=invis;
        3 -> 4 [label="2/3"];
        3 -> 5 [label="1/3"];
        4 -> 3 [label="1/3"];
        4 -> 5 [label="2/3"];
        5 -> 3 [label="2/3"];
        5 -> 4 [label="1/3"];
    }

    subgraph cluster_C4 {
        style=invis;
        6 -> 6 [label="1/2"];
        6 -> 7 [label="1/2"];
        7 -> 6 [label="1"];
    }
}
    </textarea>

    <!-- MINI EXERCISE 2 -->
    <div class="exercise">
        <div class="exercise-header">üß† Mini-Exercice 2 : Lecture de Graphe</div>
        <p>Dans le graphe ci-dessus, si le syst√®me d√©marre √† l'√©tat <strong>2</strong>, peut-il atteindre l'√©tat <strong>5</strong> ?</p>
        <button class="solution-btn" onclick="toggle('sol-2')">Voir la r√©ponse</button>
        <div id="sol-2" class="solution-content">
            <strong>R√©ponse : NON.</strong>
            <br>
            Regardez les fl√®ches partant de l'√©tat 2. La seule transition sortante m√®ne √† l'√©tat 6.
            <br>Une fois en 6, on peut aller en 7 et revenir en 6. Il n'y a aucun chemin (suite de fl√®ches) qui relie le groupe {6, 7} au groupe {3, 4, 5}.
        </div>
    </div>

    <!-- ================= CHAPTER 6 ================= -->
    <h2>Chapitre 6 : Calculs et R√©gime Stationnaire</h2>

    <h3>6.1. Distributions Transitoires</h3>
    <p>Si $\Pi_0$ est le vecteur de probabilit√© initial, l'√©tat √† l'√©tape $n$ est donn√© par :</p>
    $$ \Pi_{n} = \Pi_0 \times P^n $$

    <h3>6.2. Distribution Stationnaire ($\Pi$)</h3>
    <div class="box tip">
        <h4>üí° Pro-Tip : L'√âquilibre</h4>
        <p>Le r√©gime stationnaire repr√©sente l'√©tat "d'√©quilibre" du syst√®me apr√®s un temps tr√®s long. C'est une distribution de probabilit√© constante.</p>
    </div>
    
    <p>Pour trouver $\Pi = [\pi_1, \pi_2, \dots]$, on r√©sout le syst√®me lin√©aire :</p>
    <ol>
        <li>$\Pi = \Pi P$ (Invariance)</li>
        <li>$\sum \pi_i = 1$ (Normalisation)</li>
    </ol>

    <!-- MINI EXERCISE 3 -->
    <div class="exercise">
        <div class="exercise-header">‚úèÔ∏è Mini-Exercice 3 : Calcul Stationnaire</div>
        <p>Soit la matrice $P = \begin{pmatrix} 0.5 & 0.5 \\ 1 & 0 \end{pmatrix}$. Trouvez la distribution stationnaire $(\pi_1, \pi_2)$.</p>
        <button class="solution-btn" onclick="toggle('sol-3')">Voir la r√©ponse</button>
        <div id="sol-3" class="solution-content">
            <strong>R√©solution :</strong>
            <br>
            1. √âquation : $(\pi_1, \pi_2) = (\pi_1, \pi_2) \times P$
            $$ \begin{cases} \pi_1 = 0.5\pi_1 + 1\pi_2 \\ \pi_2 = 0.5\pi_1 + 0\pi_2 \end{cases} $$
            2. De la 2√®me ligne : $\pi_2 = 0.5\pi_1$.
            <br>
            3. Normalisation : $\pi_1 + \pi_2 = 1$.
            <br>
            Substituons : $\pi_1 + 0.5\pi_1 = 1 \implies 1.5\pi_1 = 1 \implies \pi_1 = 2/3$.
            <br>
            Donc $\pi_2 = 1/3$.
            <br>
            <strong>$\Pi = [2/3, 1/3]$</strong>.
        </div>
    </div>

    <h3>6.3. √âtude de Cas : La File d'Attente avec Perte</h3>
    <p>Mod√©lisation d'un buffer (taille $K$) o√π les paquets arrivent (prob $a$) et sont servis (prob $1-p$). Si le buffer est plein, les nouveaux paquets sont perdus.</p>
    
    <!-- GRAPH RENDERING AREA -->
    <div class="graph-container" id="graph-queue"></div>
    <textarea class="graph-source" data-target="graph-queue">
digraph PacketQueue {
    rankdir=LR;
    bgcolor="transparent";
    node [shape=circle, style=filled, fillcolor="#e6f3ff", fontname="Arial"];
    
    0 [label="0"];
    1 [label="1"];
    2 [label="2"];
    dots [label="...", shape=none, style=none, width=0.5];
    k [label="k"];
    k1 [label="k+1"];

    // Mont√©e (Arriv√©e + √âchec Service)
    0 -> 1 [label="ap"];
    1 -> 2 [label="ap"];
    2 -> dots [label="ap"];
    dots -> k [label="ap"];
    k -> k1 [label="ap"];
    
    // Descente (Pas d'arriv√©e + Succ√®s Service)
    1 -> 0 [label="(1-a)(1-p)"];
    2 -> 1 [label="(1-a)(1-p)"];
    dots -> 2 [label="(1-a)(1-p)"];
    k -> dots [label="(1-a)(1-p)"];
    k1 -> k [label="(1-a)(1-p)"];
}
    </textarea>

    <div class="box vigilance">
        <h4>‚ö†Ô∏è Condition de Stabilit√©</h4>
        <p>Pour que la file ne sature pas ind√©finiment (dans le cas d'une file infinie), il faut que le "d√©bit d'entr√©e" soit inf√©rieur au "d√©bit de sortie".</p>
        $$ a < 1-p $$
        <small>(Taux d'arriv√©e < Taux de service)</small>
    </div>

    <!-- ================= SOLUTIONS SECTION ================= -->
    <h2 id="corriges">üìù Corrig√©s D√©taill√©s des Travaux Dirig√©s</h2>
    
    <p>Voici les solutions d√©taill√©es, √©tape par √©tape, des exemples complexes vus dans le cours.</p>

    <h3>Exercice A : Classification Compl√®te des √âtats</h3>
    <p><strong>Objectif :</strong> Analyser le graphe de la section 5.3 et d√©terminer les classes.</p>
    
    <table class="sol-table">
        <thead>
            <tr>
                <th>√âtape</th>
                <th>Analyse</th>
                <th>Conclusion</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1. √âtat 1</td>
                <td>On peut aller vers 2 et 3. Une fois en 3, on est pi√©g√© dans {3,4,5}. Une fois en 2, on va vers 6. Impossible de revenir en 1.</td>
                <td><strong>Transitoire</strong></td>
            </tr>
            <tr>
                <td>2. √âtat 2</td>
                <td>M√®ne obligatoirement √† 6. Le groupe {6,7} est clos. Impossible de revenir en 2.</td>
                <td><strong>Transitoire</strong></td>
            </tr>
            <tr>
                <td>3. Classe {3,4,5}</td>
                <td>3 va √† 4 et 5. 4 va √† 3 et 5. 5 va √† 3 et 4. Ils communiquent tous entre eux. Aucune fl√®che ne sort de ce groupe vers l'ext√©rieur.</td>
                <td><strong>Classe R√©currente Ferm√©e</strong></td>
            </tr>
            <tr>
                <td>4. Classe {6,7}</td>
                <td>6 et 7 forment une boucle ferm√©e. Impossible d'en sortir.</td>
                <td><strong>Classe R√©currente Ferm√©e</strong></td>
            </tr>
        </tbody>
    </table>
    <p><em>Conclusion Globale :</em> La cha√Æne n'est pas irr√©ductible car elle poss√®de plusieurs classes ferm√©es disjointes.</p>

    <h3>Exercice B : R√©solution de la File d'Attente (G√©om√©trique)</h3>
    <p><strong>Objectif :</strong> Trouver la probabilit√© $\pi_k$ qu'il y ait $k$ paquets dans le syst√®me.</p>

    <table class="sol-table">
        <thead>
            <tr>
                <th>√âtape</th>
                <th>Formule / Action</th>
                <th>R√©sultat Interm√©diaire</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1. √âquation de Coupe</td>
                <td>Le flux qui passe de l'√©tat $k$ √† $k+1$ doit √©galer le flux qui revient de $k+1$ √† $k$ (√©quilibre local).</td>
                <td>$\pi_k \cdot (ap) = \pi_{k+1} \cdot (1-a)(1-p)$</td>
            </tr>
            <tr>
                <td>2. D√©finition de la raison</td>
                <td>On isole $\pi_{k+1}$ pour trouver la relation de r√©currence.</td>
                <td>$\pi_{k+1} = \pi_k \cdot \frac{ap}{(1-a)(1-p)}$<br>Posons $q = \frac{ap}{(1-a)(1-p)}$</td>
            </tr>
            <tr>
                <td>3. Solution G√©n√©rale</td>
                <td>C'est une suite g√©om√©trique.</td>
                <td>$\pi_k = \pi_0 \cdot q^k$</td>
            </tr>
            <tr>
                <td>4. Trouver $\pi_0$</td>
                <td>On utilise la somme des probabilit√©s : $\sum_{k=0}^{\infty} \pi_k = 1$.<br>Somme d'une s√©rie g√©om√©trique : $\frac{1}{1-q}$.</td>
                <td>$\pi_0 ( \frac{1}{1-q} ) = 1 \implies \mathbf{\pi_0 = 1 - q}$</td>
            </tr>
        </tbody>
    </table>
    <p><strong>Formule Finale :</strong> $\pi_k = (1-q)q^k$ (Loi G√©om√©trique).</p>

</div>

<!-- JAVASCRIPT LOGIC -->
<script type="module">
    // Import Libraries
    import { instance } from "https://unpkg.com/@viz-js/viz@3.2.0/lib/viz-standalone.mjs";
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    mermaid.initialize({ startOnLoad: false, theme: 'default' });

    // Render Dot Function
    async function renderDot(code, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '<div style="color:gray;">G√©n√©ration du graphique...</div>';
        try {
            const viz = await instance();
            const svg = viz.renderString(code, { engine: 'dot', format: 'svg' });
            container.innerHTML = svg;
        } catch (err) {
            container.innerHTML = `<p style="color:red">Erreur Dot: ${err.message}</p>`;
        }
    }

    // Main Logic to Find and Render Graphs
    async function renderAllGraphs() {
        const sources = document.querySelectorAll('.graph-source');
        
        for (const source of sources) {
            const targetId = source.getAttribute('data-target');
            const code = source.value;
            // We assume all our examples here are DOT for stability with the provided text
            await renderDot(code, targetId);
        }
    }

    // Run on load
    window.addEventListener('DOMContentLoaded', () => {
        renderAllGraphs();
    });
</script>

<script>
    // Simple function for toggling solutions (Non-module script)
    function toggle(id) {
        var x = document.getElementById(id);
        if (x.style.display === "block") {
            x.style.display = "none";
        } else {
            x.style.display = "block";
        }
    }
</script>

</body>
</html>