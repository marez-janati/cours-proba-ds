<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours Interactif : Cha√Ænes de Markov √† Temps Continu (CTMC)</title>
    
    <!-- MathJax Configuration for LaTeX Rendering -->
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg-light: #f4f6f8;
            --text: #333;
            --code-bg: #2d2d2d;
            --code-text: #f8f8f2;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text);
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-light);
        }

        h1, h2, h3 { color: var(--primary); }
        h1 { text-align: center; border-bottom: 3px solid var(--accent); padding-bottom: 10px; }
        h2 { border-left: 5px solid var(--accent); padding-left: 10px; margin-top: 40px; background: white; padding: 10px; border-radius: 0 5px 5px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* Educational Boxes */
        .box { padding: 15px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); background: white; }
        
        .definition { border-left: 5px solid #2196F3; background-color: #E3F2FD; }
        .definition h4 { margin-top: 0; color: #1565C0; display: flex; align-items: center; gap: 8px; }
        
        .vigilance { border-left: 5px solid #f44336; background-color: #FFEBEE; }
        .vigilance h4 { margin-top: 0; color: #c62828; display: flex; align-items: center; gap: 8px; }
        
        .protip { border-left: 5px solid #FFC107; background-color: #FFF8E1; }
        .protip h4 { margin-top: 0; color: #F57F17; display: flex; align-items: center; gap: 8px; }

        /* Interactive Exercises */
        .exercise { border: 1px solid #ccc; background: #fff; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .exercise h4 { margin-top: 0; color: var(--primary); }
        .toggle-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .toggle-btn:hover { background-color: #2980b9; }
        .solution-content {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 3px solid #27ae60;
            animation: fadeIn 0.5s;
        }

        /* Graphs */
        .graph-container {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: white;
            border: 1px dashed #ccc;
            border-radius: 8px;
            overflow-x: auto;
        }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: var(--primary); color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }

        /* Code Blocks */
        pre { background: var(--code-bg); color: var(--code-text); padding: 15px; border-radius: 5px; overflow-x: auto; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <h1>PARTIE III : CHA√éNES DE MARKOV √Ä TEMPS CONTINU (CTMC)</h1>

    <div class="box protip">
        <h4>üí° Introduction</h4>
        <p>Dans les chapitres pr√©c√©dents (DTMC), le temps avan√ßait par "sauts" ($t=0, 1, 2...$). Ici, le temps s'√©coule de mani√®re fluide ($t \in \mathbb{R}^+$). Imaginez la diff√©rence entre un jeu au tour par tour (DTMC) et un jeu en temps r√©el (CTMC).</p>
    </div>

    <!-- CHAPITRE 7 -->
    <h2>Chapitre 7 : Construction des CTMC</h2>

    <h3>7.1. D√©finition et Temps de S√©jour</h3>

    <div class="box definition">
        <h4>üìò D√©finition</h4>
        <p>Une <strong>CTMC</strong> est un processus o√π le syst√®me change d'√©tat √† des instants al√©atoires. Une fois entr√© dans un √©tat $s$, le syst√®me y reste pendant une dur√©e al√©atoire appel√©e <strong>temps de s√©jour</strong> ($T_s$).</p>
    </div>

    <p>La propri√©t√© cl√© est l'<strong>absence de m√©moire</strong>. Si vous attendez le bus depuis 10 minutes, la probabilit√© qu'il arrive dans la prochaine minute est la m√™me que si vous veniez d'arriver (si le bus suit un processus de Poisson).</p>

    <p>Math√©matiquement, cela impose que le temps de s√©jour suive une <strong>Loi Exponentielle</strong> :</p>
    $$ f(t) = \lambda_s e^{-\lambda_s t} $$
    <p>O√π $\lambda_s$ est le <strong>taux de sortie</strong> de l'√©tat $s$.</p>

    <!-- Mini-Exercice 1 -->
    <div class="exercise">
        <h4>üöÄ Mini-Exercice 1 : Calcul de Proba</h4>
        <p>On suppose qu'un serveur informatique est dans l'√©tat "En ligne" ($s$). Le taux de panne est de $\lambda_s = 0.5$ panne par heure.</p>
        <p><strong>Question :</strong> Quelle est la probabilit√© que le serveur tombe en panne dans les 2 prochaines heures ?</p>
        
        <button class="toggle-btn" onclick="toggleSol('sol1')">Voir la solution</button>
        <div id="sol1" class="solution-content">
            <p>On cherche $P(T_s \le 2)$. C'est la fonction de r√©partition de la loi exponentielle :</p>
            $$ F(t) = 1 - e^{-\lambda_s t} $$
            $$ P(T_s \le 2) = 1 - e^{-0.5 \times 2} = 1 - e^{-1} \approx 1 - 0.368 = 0.632 $$
            <p>Il y a <strong>63.2%</strong> de chances qu'il tombe en panne dans les 2h.</p>
        </div>
    </div>

    <h3>7.2. Le G√©n√©rateur Infinit√©simal $Q$</h3>

    <p>Au lieu d'une matrice de probabilit√©s $P$, nous utilisons une matrice de <strong>taux</strong> $Q$.</p>

    <div class="graph-container" id="viz-graph-Q"></div>
    <script type="text/vnd.graphviz" id="code-graph-Q">
    digraph GeneratorQ {
        rankdir=LR;
        bgcolor="transparent";
        node [shape=circle, style=filled, fillcolor="#E0F7FA", fontname="Helvetica", fixedsize=true, width=0.8];
        edge [fontname="Helvetica", fontsize=12];
        s [label="s"];
        s_prime [label="s'"];
        s_second [label="s''"];
        s -> s_prime [label="Œª"];
        s -> s_second [label="Œº"];
        s -> s [label="- (Œª + Œº)", fontcolor=red, color=red, style=dashed];
    }
    </script>

    <div class="box vigilance">
        <h4>‚ö†Ô∏è Zone de Vigilance : Propri√©t√©s de $Q$</h4>
        <ul>
            <li><strong>Hors diagonale ($q_{ij}, i \neq j$) :</strong> Toujours $\ge 0$ (ce sont des taux).</li>
            <li><strong>Diagonale ($q_{ii}$) :</strong> Toujours $\le 0$. C'est l'oppos√© de la somme des autres termes de la ligne.</li>
            <li><strong>Somme des lignes :</strong> La somme de chaque ligne doit faire <strong>exactement 0</strong>.</li>
        </ul>
    </div>

    <!-- Mini-Exercice 2 -->
    <div class="exercise">
        <h4>üöÄ Mini-Exercice 2 : Compl√©ter la Matrice</h4>
        <p>Soit la matrice $Q$ incompl√®te suivante. Trouvez $x$.</p>
        $$ Q = \begin{pmatrix} -3 & 2 & 1 \\ 4 & x & 1 \\ 0 & 2 & -2 \end{pmatrix} $$
        
        <button class="toggle-btn" onclick="toggleSol('sol2')">Voir la solution</button>
        <div id="sol2" class="solution-content">
            <p>La somme des lignes doit √™tre nulle ($\sum_j q_{ij} = 0$).</p>
            <p>Pour la ligne 2 : $4 + x + 1 = 0 \implies 5 + x = 0 \implies x = -5$.</p>
            <p>Donc, le taux de sortie total de l'√©tat 1 est de 5.</p>
        </div>
    </div>

    <h3>7.3. La Cha√Æne Incluse (Embedded DTMC)</h3>

    <p>C'est la "s√©quence des √©tats visit√©s" sans regarder le temps.</p>
    $$ P^{inc}(s, s') = \frac{q_{ss'}}{-q_{ss}} \quad \text{si } s \neq s' $$

    <!-- Mini-Exercice 3 -->
    <div class="exercise">
        <h4>üöÄ Mini-Exercice 3 : De $Q$ vers $P$</h4>
        <p>Si je sors de l'√©tat 1 avec un taux total de 5 ($q_{11}=-5$), et que le taux vers l'√©tat 2 est $q_{12}=4$. Quelle est la probabilit√© que mon prochain √©tat soit le 2 ?</p>
        
        <button class="toggle-btn" onclick="toggleSol('sol3')">Voir la solution</button>
        <div id="sol3" class="solution-content">
            $$ p_{1,2} = \frac{4}{5} = 0.8 $$
            <p>Il y a 80% de chances que la prochaine transition soit vers l'√©tat 2.</p>
        </div>
    </div>

    <!-- CHAPITRE 8 -->
    <h2>Chapitre 8 : Analyse √† l'√âquilibre</h2>

    <h3>8.1. √âquations de Balance Globale</h3>

    <p>√Ä l'√©quilibre (r√©gime stationnaire), le syst√®me est stable :</p>
    <div class="box definition">
        <h4>üìò Flux Entrant = Flux Sortant</h4>
        <p>Pour tout √©tat $i$, la "masse" de probabilit√© qui sort doit √™tre √©gale √† celle qui rentre.</p>
        $$ \pi_i \times (\text{Taux total sortie}) = \sum_{j \neq i} \pi_j \times (\text{Taux } j \to i) $$
    </div>

    <!-- Mini-Exercice 4 -->
    <div class="exercise">
        <h4>üöÄ Mini-Exercice 4 : √âcriture d'√©quation</h4>
        <p>Regardez le graphe ci-dessous. √âcrivez l'√©quation de balance pour le n≈ìud <strong>0</strong>.</p>
        <div class="graph-container" id="viz-graph-mini4"></div>
        <script type="text/vnd.graphviz" id="code-graph-mini4">
        digraph Mini4 {
            rankdir=LR;
            bgcolor="transparent";
            node [shape=circle, style=filled, fillcolor="#FFF9C4"];
            0 -> 1 [label="Œª"];
            1 -> 0 [label="Œº"];
        }
        </script>
        
        <button class="toggle-btn" onclick="toggleSol('sol4')">Voir la solution</button>
        <div id="sol4" class="solution-content">
            <ul>
                <li><strong>Flux sortant de 0 :</strong> $\pi_0 \times \lambda$</li>
                <li><strong>Flux entrant vers 0 :</strong> $\pi_1 \times \mu$</li>
            </ul>
            <p><strong>√âquation :</strong> $\lambda \pi_0 = \mu \pi_1$</p>
        </div>
    </div>

    <!-- CORRIG√âS ET D√âTAILS -->
    <h2>üìù Corrig√©s des Travaux Dirig√©s</h2>

    <p>Cette section d√©taille pas √† pas la r√©solution des syst√®mes pr√©sent√©s dans le cours.</p>

    <h3>Exercice A : Syst√®me Simple (2 √âtats)</h3>
    <p><strong>Objectif :</strong> Trouver la distribution stationnaire $\pi = [\pi_0, \pi_1]$ pour $Q = \begin{bmatrix} -\lambda & \lambda \\ \lambda & -\lambda \end{bmatrix}$.</p>

    <table>
        <thead>
            <tr>
                <th>√âtape</th>
                <th>Action</th>
                <th>R√©sultat Math√©matique</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1. Balance</td>
                <td>√âcrire "Sortie = Entr√©e" pour l'√©tat 0</td>
                <td>$\lambda \pi_0 = \lambda \pi_1$</td>
            </tr>
            <tr>
                <td>2. Simplification</td>
                <td>Diviser par $\lambda$</td>
                <td>$\pi_0 = \pi_1$</td>
            </tr>
            <tr>
                <td>3. Normalisation</td>
                <td>Utiliser $\sum \pi_i = 1$</td>
                <td>$\pi_0 + \pi_1 = 1$</td>
            </tr>
            <tr>
                <td>4. Substitution</td>
                <td>Remplacer $\pi_1$ par $\pi_0$</td>
                <td>$\pi_0 + \pi_0 = 1 \implies 2\pi_0 = 1$</td>
            </tr>
            <tr>
                <td><strong>R√©sultat</strong></td>
                <td>Calcul final</td>
                <td><strong>$\pi_0 = 0.5, \quad \pi_1 = 0.5$</strong></td>
            </tr>
        </tbody>
    </table>

    <h3>Exercice B : Syst√®me Complexe (3 √âtats)</h3>
    <div class="box protip">
        <h4>üí° Contexte</h4>
        <p>Voici la r√©solution compl√®te de l'exemple du cours avec la matrice :</p>
        $$ Q = \begin{bmatrix} -5 & 5 & 0 \\ 1 & -2 & 1 \\ 3 & 1 & -4 \end{bmatrix} $$
    </div>

    <div class="graph-container" id="viz-graph-complex"></div>
    <script type="text/vnd.graphviz" id="code-graph-complex">
    digraph ThreeStateComplex {
        rankdir=TB;
        bgcolor="transparent";
        node [shape=circle, style=filled, fillcolor="#E1BEE7", fontname="Helvetica", fixedsize=true, width=0.7];
        edge [fontname="Helvetica", fontsize=12];
        { rank=same; 1; 2; }
        0 [label="0"]; 1 [label="1"]; 2 [label="2"];
        0 -> 1 [label="5"];
        1 -> 0 [label="1"]; 1 -> 2 [label="1"];
        2 -> 0 [label="3"]; 2 -> 1 [label="1"];
    }
    </script>

    <h4>R√©solution pas √† pas :</h4>

    <div class="exercise" style="border-left: 5px solid var(--primary);">
        <p><strong>Syst√®me d'√©quations brut ($\pi Q = 0$) :</strong></p>
        <ol>
            <li>$-5\pi_0 + 1\pi_1 + 3\pi_2 = 0$ (Colonne 0) $\iff 5\pi_0 = \pi_1 + 3\pi_2$</li>
            <li>$5\pi_0 - 2\pi_1 + 1\pi_2 = 0$ (Colonne 1) $\iff 2\pi_1 = 5\pi_0 + \pi_2$</li>
            <li>$0\pi_0 + 1\pi_1 - 4\pi_2 = 0$ (Colonne 2) $\iff \mathbf{\pi_1 = 4\pi_2}$ <span style="color:green;">(Cl√© !)</span></li>
        </ol>
        <p><strong>Contrainte :</strong> $\pi_0 + \pi_1 + \pi_2 = 1$</p>

        <hr>

        <p><strong>Strat√©gie de Pivot (Tout exprimer en fonction de $\pi_2$) :</strong></p>
        
        <p>1. On sait d√©j√† que :</p>
        $$ \pi_1 = 4\pi_2 $$

        <p>2. Utilisons l'√©quation (1) en rempla√ßant $\pi_1$ :</p>
        $$ 5\pi_0 = (4\pi_2) + 3\pi_2 = 7\pi_2 $$
        $$ \pi_0 = \frac{7}{5}\pi_2 = 1.4\pi_2 $$

        <p>3. Injectons tout dans la normalisation :</p>
        $$ (1.4\pi_2) + (4\pi_2) + (1\pi_2) = 1 $$
        $$ 6.4\pi_2 = 1 $$
        $$ \pi_2 = \frac{1}{6.4} = \frac{10}{64} = \frac{5}{32} $$

        <p>4. Remontons pour trouver les autres :</p>
        $$ \pi_1 = 4 \times \frac{5}{32} = \frac{20}{32} = \frac{5}{8} $$
        $$ \pi_0 = \frac{7}{5} \times \frac{5}{32} = \frac{7}{32} $$

        <div class="box definition" style="border-color: green; background: #e8f5e9;">
            <h4>‚úÖ Solution Finale</h4>
            $$ \pi = \left[ \frac{7}{32}, \quad \frac{20}{32}, \quad \frac{5}{32} \right] $$
        </div>
    </div>

    <script type="module">
        // Import Viz.js for Graphviz rendering
        import { instance } from "https://unpkg.com/@viz-js/viz@3.2.0/lib/viz-standalone.mjs";

        // Function to render Graphviz diagrams
        async function renderGraphs() {
            const viz = await instance();
            
            const graphIds = ['code-graph-Q', 'code-graph-mini4', 'code-graph-complex'];
            const targetIds = ['viz-graph-Q', 'viz-graph-mini4', 'viz-graph-complex'];

            for (let i = 0; i < graphIds.length; i++) {
                const code = document.getElementById(graphIds[i]).textContent;
                try {
                    const svg = viz.renderString(code, { engine: 'dot', format: 'svg' });
                    document.getElementById(targetIds[i]).innerHTML = svg;
                } catch (e) {
                    console.error("Graph error:", e);
                    document.getElementById(targetIds[i]).innerHTML = "Error rendering graph.";
                }
            }
        }

        // Trigger rendering
        renderGraphs();
    </script>

    <script>
        // Simple function to toggle solution visibility
        function toggleSol(id) {
            const x = document.getElementById(id);
            if (x.style.display === "block") {
                x.style.display = "none";
            } else {
                x.style.display = "block";
            }
        }
    </script>

</body>
</html>